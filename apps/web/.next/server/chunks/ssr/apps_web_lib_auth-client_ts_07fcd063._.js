module.exports=[62453,a=>{"use strict";var b=a.i(72131);function c(a,d={}){let e=(0,b.useCallback)(b=>{var c;let e;return d.keys?(c=d.keys,e=new Set(c).add(void 0),a.listen((a,c,d)=>{e.has(d)&&b(a,c,d)})):a.listen(b)},[d.keys,a]),f=a.get.bind(a);return(0,b.useSyncExternalStore)(e,f,f)}var d=Object.defineProperty,e=Object.defineProperties,f=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,j=(a,b,c)=>b in a?d(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,k=(a,b)=>{for(var c in b||(b={}))h.call(b,c)&&j(a,c,b[c]);if(g)for(var c of g(b))i.call(b,c)&&j(a,c,b[c]);return a},l=(a,b)=>e(a,f(b)),m=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c,Error.captureStackTrace(this,this.constructor)}},n=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},o=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},p=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},q=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let[d,e]=await Promise.all([c(a.auth.username),c(a.auth.password)]);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let[d,e]=await Promise.all([c(a.auth.prefix),c(a.auth.value)]);if(!e)return b;b.authorization=`${null!=d?d:""} ${e}`}}return b},r=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function s(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function t(a){try{return JSON.parse(a)}catch(b){return a}}async function u(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await q(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=s(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var v=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function w(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new v(c.issues);return c.value}var x=["get","post","put","patch","delete"],y=async(a,b)=>{var c,d,e,f,g,h,i,j;let q,{hooks:v,url:z,options:A}=await n(a,b),B=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&"function"==typeof globalThis.fetch)return globalThis.fetch;throw Error("No fetch implementation found")}(A),C=new AbortController,D=null!=(c=A.signal)?c:C.signal,E=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];x.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{})){let c;if(null!=b){if("string"==typeof b)c=b;else if(Array.isArray(b)){for(let c of b)i.append(a,c);continue}else c=JSON.stringify(b);i.set(a,c)}}if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(z,A),F=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(s(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return b.has("content-type")&&"application/x-www-form-urlencoded"===b.get("content-type")&&s(a.body)?new URLSearchParams(a.body).toString():a.body}(A),G=await u(A),H=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return x.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(z,A),I=l(k({},A),{url:E,headers:G,body:F,method:H,signal:D});for(let a of v.onRequest)if(a){let b=await a(I);"object"==typeof b&&null!==b&&(I=b)}("pipeTo"in I&&"function"==typeof I.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in I)&&(I.duplex="half");let{clearTimeout:J}=(!(null==A?void 0:A.signal)&&(null==A?void 0:A.timeout)&&(q=setTimeout(()=>null==C?void 0:C.abort(),null==A?void 0:A.timeout)),{abortTimeout:q,clearTimeout:()=>{q&&clearTimeout(q)}}),K=await B(I.url,I);J();let L={response:K,request:I};for(let a of v.onResponse)if(a){let c=await a(l(k({},L),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?K.clone():K}));c instanceof Response?K=c:"object"==typeof c&&null!==c&&(K=c.response)}if(K.ok){if("HEAD"===I.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return r.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(K),c={data:null,response:K,request:I};if("json"===a||"text"===a){let a=await K.text(),b=null!=(f=I.jsonParser)?f:t;c.data=await b(a)}else c.data=await K[a]();for(let a of((null==I?void 0:I.output)&&I.output&&!I.disableValidation&&(c.data=await w(I.output,c.data)),v.onSuccess))a&&await a(l(k({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?K.clone():K}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let M=null!=(h=null==b?void 0:b.jsonParser)?h:t,N=await K.text(),O=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(N),P=O?await M(N):null,Q={response:K,responseText:N,request:I,error:l(k({},P),{status:K.status,statusText:K.statusText})};for(let a of v.onError)a&&await a(l(k({},Q),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?K.clone():K}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new o({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new o(a);case"exponential":return new p(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,K)){for(let a of v.onRetry)a&&await a(L);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await y(a,l(k({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new m(K.status,K.statusText,O?P:N);return{data:null,error:l(k({},P),{status:K.status,statusText:K.statusText})}};let z=[],A=0,B=0,C=a=>{let b=[],c={get:()=>(c.lc||c.listen(()=>{})(),c.value),lc:0,listen:a=>(c.lc=b.push(a),()=>{for(let b=A+4;b<z.length;)z[b]===a?z.splice(b,4):b+=4;let d=b.indexOf(a);~d&&(b.splice(d,1),--c.lc||c.off())}),notify(a,d){B++;let e=!z.length;for(let e of b)z.push(e,c.value,a,d);if(e){for(A=0;A<z.length;A+=4)z[A](z[A+1],z[A+2],z[A+3]);z.length=0}},off(){},set(a){let b=c.value;b!==a&&(c.value=a,c.notify(b))},subscribe(a){let b=c.listen(a);return a(c.value),b},value:a};return c},D=(a,b)=>{var c,d;return c=c=>{let d=b(c);d&&a.events[6].push(d)},d=b=>{let c=a.listen;a.listen=(...d)=>(a.lc||a.active||(a.active=!0,b()),c(...d));let d=a.off;return a.events[6]=[],a.off=()=>{d(),setTimeout(()=>{if(a.active&&!a.lc){for(let b of(a.active=!1,a.events[6]))b();a.events[6]=[]}},1e3)},()=>{a.listen=c,a.off=d}},a.events=a.events||{},a.events[15]||(a.events[15]=d(b=>{a.events[5].reduceRight((a,b)=>(b(a),a),{shared:{},...b})})),a.events[5]=a.events[5]||[],a.events[5].push(c),()=>{let b=a.events[5],d=b.indexOf(c);b.splice(d,1),b.length||(delete a.events[5],a.events[15](),delete a.events[15])}};var E=class extends Error{constructor(a,b){super(a),this.name="BetterAuthError",this.message=a,this.cause=b,this.stack=""}};function F(a,b="/api/auth"){return!function(a){try{return"/"!==new URL(a).pathname}catch{throw new E(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a)?(b=b.startsWith("/")?b:`/${b}`,`${a}${b}`):a}var G={id:"redirect",name:"Redirect",hooks:{onSuccess(a){a.data?.url&&a.data?.redirect}}},H={id:"add-current-url",name:"Add current URL",hooks:{onRequest:a=>a}},I={id:"csrf",name:"CSRF Check",async init(a,b){if(b?.method!=="GET"){b=b||{};let{data:a,error:c}=await y("/csrf",{body:void 0,baseURL:b.baseURL,plugins:[],method:"GET",credentials:"include",customFetchImpl:b.customFetchImpl});if(c){if(404===c.status)throw new E("CSRF route not found. Make sure the server is running and the base URL is correct and includes the path (e.g. http://localhost:3000/api/auth).");if(429===c.status)return new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests"});throw new E("Failed to fetch CSRF token: "+c.message)}let d=a?.csrfToken;b.body={...b?.body,csrfToken:d}}return b.credentials="include",{url:a,options:b}}};let J=function(a){var b,d,e;let f,{pluginPathMethods:g,pluginsActions:h,pluginsAtoms:i,$fetch:j,atomListeners:m}=(a=>{var b;let c=(b={baseURL:function(a,b){if(a)return F(a,void 0);let c="u">typeof process?process.env:{},d=c.BETTER_AUTH_URL||c.NEXT_PUBLIC_BETTER_AUTH_URL||c.PUBLIC_BETTER_AUTH_URL||c.NUXT_PUBLIC_BETTER_AUTH_URL||c.NUXT_PUBLIC_AUTH_URL||("/"!==c.BASE_URL?c.BASE_URL:void 0);if(d)return F(d,void 0)}(a?.fetchOptions?.baseURL||a?.baseURL),credentials:"include",method:"GET",...a?.fetchOptions,plugins:[...a?.disableCSRFTokenCheck?[]:[I],G,H,...a?.fetchOptions?.plugins?.filter(a=>void 0!==a)||[],...a?.plugins?.flatMap(a=>a.fetchPlugins).filter(a=>void 0!==a)||[]]},async function(a,c){let d,e=l(k(k({},b),c),{plugins:[...(null==b?void 0:b.plugins)||[],(d=b||{},{id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(a,b){var c,e,f,g;let h=(null==(e=null==(c=d.plugins)?void 0:c.find(b=>{var c;return null!=(c=b.schema)&&!!c.config&&(a.startsWith(b.schema.config.baseURL||"")||a.startsWith(b.schema.config.prefix||""))}))?void 0:e.schema)||d.schema;if(h){let c=a;(null==(f=h.config)?void 0:f.prefix)&&c.startsWith(h.config.prefix)&&(c=c.replace(h.config.prefix,""),h.config.baseURL&&(a=a.replace(h.config.prefix,h.config.baseURL))),(null==(g=h.config)?void 0:g.baseURL)&&c.startsWith(h.config.baseURL)&&(c=c.replace(h.config.baseURL,""));let d=h.schema[c];if(d){let c=l(k({},b),{method:d.method,output:d.output});return(null==b?void 0:b.disableValidation)||(c=l(k({},c),{body:d.input?await w(d.input,null==b?void 0:b.body):null==b?void 0:b.body,params:d.params?await w(d.params,null==b?void 0:b.params):null==b?void 0:b.params,query:d.query?await w(d.query,null==b?void 0:b.query):null==b?void 0:b.query})),{url:a,options:c}}}return{url:a,options:b}}}),...(null==c?void 0:c.plugins)||[]]});if(null==b?void 0:b.catchAllError)try{return await y(a,e)}catch(a){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:a}}}return await y(a,e)}),d=a?.plugins||[],e={},f={},g={"/sign-out":"POST","/user/revoke-sessions":"POST"},h=[{signal:"_sessionSignal",matcher:a=>"/sign-out"===a||"/user/update"===a||a.startsWith("/sign-in")||a.startsWith("/sign-up")}];for(let a of d)a.getActions&&Object.assign(e,a.getActions?.(c)),a.getAtoms&&Object.assign(f,a.getAtoms?.(c)),a.pathMethods&&Object.assign(g,a.pathMethods),a.atomListeners&&h.push(...a.atomListeners);return{pluginsActions:e,pluginsAtoms:f,pluginPathMethods:g,atomListeners:h,$fetch:c}})(a),n={};for(let[a,b]of Object.entries(i)){n[`use${(e=a).charAt(0).toUpperCase()+e.slice(1)}`]=()=>c(b)}let{$session:o,_sessionSignal:p,$Infer:q}={$session:((a,b,c,d)=>{let e=C({data:null,error:null,isPending:!1,isRefetching:!1}),f=()=>{let a="function"==typeof d?d({data:e.get().data,error:e.get().error,isPending:e.get().isPending}):d;return c(b,{...a,onSuccess:async b=>{e.set({data:b.data,error:null,isPending:!1,isRefetching:!1}),await a?.onSuccess?.(b)},async onError(b){e.set({error:b.error,data:null,isPending:!1,isRefetching:!1}),await a?.onError?.(b)},async onRequest(b){let c=e.get();e.set({isPending:null===c.data,data:c.data,error:null,isRefetching:!0}),await a?.onRequest?.(b)}})};a=Array.isArray(a)?a:[a];let g=!1;for(let b of a)b.subscribe(()=>{g?f():D(e,()=>(f(),g=!0,()=>{e.off(),b.off()}))});return e})(f=C(!1),"/session",j,{method:"GET"}),_sessionSignal:f,$Infer:{}};return b={...h,...n,useSession:function(a){return c(o)}},d={...i,_sessionSignal:p},function a(c=[]){return new Proxy(function(){},{get(d,e){let f=[...c,e],g=b;for(let a of f)if(g&&"object"==typeof g&&a in g)g=g[a];else{g=void 0;break}return"function"==typeof g?g:a(f)},apply:async(a,b,e)=>{let f="/"+c.map(a=>a.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`)).join("/"),h=e[0]||{},i=e[1]||{},{query:k,fetchOptions:l,...n}=h,o={...i,...l},p=function(a,b,c){let d=b[a],{fetchOptions:e,query:f,...g}=c||{};return d||(e?.method?e.method:g&&Object.keys(g).length>0?"POST":"GET")}(f,g,h);return await j(f,{...o,body:"GET"===p?void 0:{...n,...o?.body||{}},query:k||o?.query,method:p,async onSuccess(a){await o?.onSuccess?.(a);let b=m?.find(a=>a.matcher(f));if(!b)return;let c=d[b.signal];if(!c)return;let e=c.get();setTimeout(()=>{c.set(!e)},10)}})}})}()}({baseURL:"/api/auth",fetchOptions:{credentials:"include"}});a.s(["authClient",0,J],62453)}];

//# sourceMappingURL=apps_web_lib_auth-client_ts_07fcd063._.js.map